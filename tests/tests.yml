---
- hosts: localhost
  tags:
    - classic
  tasks:
    - dnf:
        name: "*"
        state: latest

- hosts: localhost
  roles:
  - role: standard-test-basic
    tags:
    - classic
    repositories:
    - repo: "https://src.fedoraproject.org/tests/python.git"
      dest: "python"
    tests:
    - rpm_qa:
        run: rpm -qa
    - smoke:
        dir: python/smoke
        run: VERSION=3.11 ./venv.sh
    - smoke_virtualenv:
        dir: python/smoke
        run: VERSION=3.11 METHOD=virtualenv ./venv.sh
    - debugsmoke:
        dir: python/smoke
        run: PYTHON=python3.11d TOX=false VERSION=3.11 ./venv.sh
    - selftest:
        dir: python/selftest
        run: VERSION=3.11 X="" ./parallel.sh
    - debugtest:
        dir: python/selftest
        run: VERSION=3.11 PYTHON=python3.11d X="" ./parallel.sh
    - debugflags:
        dir: python/flags
        run: python3.11d ./assertflags.py -O0
    - marshalparser:
        dir: python/marshalparser
        run: VERSION=3.11 SAMPLE=10 test_marshalparser_compatibility.sh
    required_packages:
    - gcc  # for extension building in venv and selftest
    - gcc-c++ # for test_cppext
    - gdb  # for test_gdb
    - python3.11  # the test subject
    - python3.11-debug  # for leak testing
    - python3.11-devel  # for extension building in venv and selftest
    - python3.11-tkinter  # for selftest
    - python3.11-test  # for selftest
    - tox  # for venv tests
    - virtualenv  # for virtualenv tests
    - glibc-all-langpacks # for locale tests
    - marshalparser  # for testing compatibility (magic numbers) with marshalparser
    - rpm  # for debugging
